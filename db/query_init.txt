CREATE TABLE project (id serial PRIMARY KEY, title TEXT);

CREATE TABLE author (id serial PRIMARY KEY, name TEXT);

CREATE TABLE issues (
    id serial PRIMARY KEY,
    projectId INT NOT NULL,
    FOREIGN KEY (projectId) REFERENCES project (id) ON DELETE CASCADE ON UPDATE CASCADE,
    authorId INT NOT NULL,
    FOREIGN KEY (authorId) REFERENCES author (id) ON DELETE CASCADE ON UPDATE CASCADE,
    assigneeId INT NOT NULL,
    key TEXT,
    summary TEXT,
    description TEXT,
    type TEXT,
    priority TEXT,
    status TEXT,
    createdTime TIMESTAMP WITHOUT TIME ZONE,
    closedTime TIMESTAMP WITHOUT TIME ZONE,
    updatedTime TIMESTAMP WITHOUT TIME ZONE,
    timeSpent INT
);

CREATE TABLE statusChange (
    issueId INT NOT NULL,
    FOREIGN KEY (issueId) REFERENCES Issue (id) ON DELETE CASCADE ON UPDATE CASCADE,
    authorId INT NOT NULL,
    FOREIGN KEY (authorId) REFERENCES Author (id) ON DELETE CASCADE ON UPDATE CASCADE,
    changeTime TIMESTAMP WITHOUT TIME ZONE,
    fromStatus TEXT,
    toStatus TEXT
);

CREATE USER pguser WITH ENCRYPTED PASSWORD 'pgpwd';

GRANT ALL PRIVILEGES ON DATABASE testdb TO pguser;